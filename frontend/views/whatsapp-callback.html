<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp Callback</title>
    <script>
        async function handleCallback() {
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get("code");

            if (!code) {
                console.error("No authorization code found.");
                document.body.innerHTML = "<h2>Error: No authorization code found.</h2>";
                return;
            }

            try {
                // Send the code to your backend
                const response = await fetch("https://fiew-account.onrender.com/whatsapp-auth", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ code })
                });

                if (!response.ok) {
                    throw new Error("Failed to authenticate WhatsApp.");
                }

                document.body.innerHTML = "<h2>WhatsApp Connected Successfully! Redirecting...</h2>";
                setTimeout(() => {
                    window.location.href = "https://lvgroup1.github.io/fiew_account/";
                }, 3000);
            } catch (error) {
                console.error("Error processing WhatsApp callback:", error);
                document.body.innerHTML = "<h2>Error connecting WhatsApp.</h2>";
            }
        }

        window.onload = handleCallback;
    </script>
</head>
<body>
    <h2>Processing WhatsApp Authentication...</h2>
</body>
</html>
